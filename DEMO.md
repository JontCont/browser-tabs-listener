# 功能演示說明

## 📖 如何測試各項功能

### 1. 分頁切換檢測
- **測試方法**: 開啟頁面後，切換到其他分頁，再切換回來
- **觀察結果**: 
  - 分頁狀態會從「活躍」變為「非活躍」再變回「活躍」
  - 焦點變化次數會增加
  - 事件日誌會記錄相關事件

### 2. 可見性檢測
- **測試方法**: 最小化瀏覽器視窗或切換到其他應用程式
- **觀察結果**:
  - 可見性狀態會從「可見」變為「隱藏」
  - 可見性變化次數會增加
  - 活躍時間統計會暫停

### 3. 新分頁檢測（改進版）
- **測試方法**: 
  - 直接在網址列輸入 URL 訪問 → 顯示「直接訪問」
  - 點擊「在新分頁開啟當前頁面」按鈕 → 顯示「新分頁/視窗開啟」
  - 從其他網站的連結點擊過來 → 顯示「外部連結開啟」
  - 從同網站的其他頁面導航 → 顯示「站內導航開啟」
  - **複製分頁** (Ctrl+Shift+T 或右鍵複製分頁) → 顯示「複製分頁開啟」
  - 從書籤開啟 → 顯示「書籤/歷史開啟」

### 4. 重複分頁檢測
- **測試方法**: 
  - 複製當前分頁的 URL
  - 快速開啟新分頁並貼上 URL (在5秒內)
  - **觀察結果**: 重複分頁狀態會顯示「是 (檢測到重複)」

### 5. 統計功能
- **活躍時間**: 只有在分頁有焦點且可見時才計算
- **總停留時間**: 從頁面載入開始的總時間
- **焦點變化次數**: 分頁失去和獲得焦點的總次數
- **可見性變化次數**: 分頁變為可見和隱藏的總次數

## 🔍 技術原理

### Focus/Blur 事件
```javascript
window.addEventListener('focus', () => {
    // 分頁獲得焦點
});

window.addEventListener('blur', () => {
    // 分頁失去焦點
});
```

### Visibility Change 事件
```javascript
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        // 分頁變為可見
    } else {
        // 分頁變為隱藏
    }
});
```

### 新分頁檢測
```javascript
if (window.opener) {
    // 在新分頁/視窗中開啟
} else {
    // 直接訪問或連結導航
}
```

### 重複分頁檢測
使用 localStorage 儲存頁面狀態，包含：
- URL
- 時間戳
- 分頁 ID

如果在短時間內 (5秒) 檢測到相同 URL 的訪問，則判定為重複分頁。

## 🎯 實際應用場景

1. **防止重複操作**: 檢測重複分頁，避免用戶重複提交表單
2. **資源管理**: 當用戶切換分頁時暫停影片播放或動畫
3. **用戶行為分析**: 追蹤用戶在頁面上的真實活躍時間
4. **會話管理**: 確保用戶只在一個分頁中進行敏感操作
5. **效能優化**: 在分頁不可見時減少不必要的計算和請求

## 🛠️ 瀏覽器兼容性

- **Focus/Blur 事件**: 所有現代瀏覽器支援
- **Visibility API**: IE10+, Chrome 14+, Firefox 10+, Safari 7+
- **localStorage**: IE8+, 所有現代瀏覽器
- **window.opener**: 所有瀏覽器支援

## 💡 注意事項

1. **安全限制**: 網頁 JavaScript 無法檢測用戶開啟了多少個分頁，只能檢測當前分頁的狀態
2. **隱私保護**: 瀏覽器會限制跨域分頁之間的通信
3. **使用者體驗**: 避免過度使用這些 API，以免影響網頁效能
4. **移動端差異**: 移動端瀏覽器的分頁切換行為可能與桌面端不同

## 🔧 自定義設定

你可以在各個 JavaScript 檔案中修改以下參數：

- **重複檢測時間窗口**: `duplicate-detector.js` 中的 5000ms
- **最大日誌數量**: `utils.js` 中的 maxLogs = 100
- **統計更新間隔**: `stats.js` 中的 1000ms 間隔
- **活動超時時間**: `stats.js` 中的 5分鐘超時
